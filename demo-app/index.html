<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Some title</title>

    <meta name="description" content="Some description">
    <base href="/">

    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/materialize.min.js"></script>


</head>

<body>


<nav class="nav-extended">
    <!--<div class="nav-wrapper">-->
    <!--<a href="#!" class="brand-logo">-->
    <!--<img src="images/logo.png" alt="Logo"/>-->
    <!--</a>-->
    <!--</div>-->
    <div class="nav-content">
        <ul class="tabs tabs-transparent">
            <li class="tab">
                <a class="active" href="#test1">
                    <i class="material-icons">search</i>
                    <span>Search</span>
                </a>
            </li>
            <li class="tab">
                <a href="#test2">
                    <i class="material-icons">album</i>
                    <span>Saved Photos</span>
                </a>
            </li>
            <li class="tab">
                <a href="#test3">
                    <i class="material-icons">location_on</i>
                    <span>Pin places</span>
                </a>
            </li>
        </ul>
    </div>
</nav>

<div class="content">
    <div id="test1" class="card col s12">
        <div class="nav-wrapper">
            <form>
                <div class="input-field">
                    <input placeholder="Enter search terms" id="search-input" type="search" required/>
                    <label class="label-icon" for="search-input"><i class="material-icons">search</i></label>
                    <i class="material-icons">close</i>
                </div>
            </form>
        </div>

        <div class="search-buttons">
            <button class="waves-effect search-btn btn">
                <i class="material-icons">youtube_searched_for</i>
                <span>Search</span>
            </button>
            <button class="waves-effect reset-btn btn">
                <i class="material-icons">settings_backup_restore</i>
                <span>Clear</span>
            </button>
        </div>

        <div class="search-results">
            <div class="row" id="result-container">

            </div>
        </div>
    </div>




    <div id="test2" class="col s12">
        <div class="row">
            <div class="col s12 m6">
                <div class="card blue-grey darken-1" id="saved-images">

                </div>
            </div>
        </div>
    </div>



    <div id="test3" class="col s12">Test 3</div>
</div>

<script>

    var loader = '<div class="progress"> <div class="indeterminate"></div> </div>';

    function getTemplate(url, title, icon) {
        return [
            '<div class="col s6 m6 image-x">',
            '<div class="card">',
            '<div class="card-image">',
            '<img src="' + url + '">',
            '<a class="btn-floating halfway-fab waves-effect save-image red" data-title="' + title+ '" data-url="' + url + '"><i class="material-icons">'+icon+'</i></a>',
            '</div>',
            '<div class="card-content">',
            '<p>' + title + '</p>',
            '</div>',
            '</div>',
            '</div>'
        ].join('');
    }

    function parseImage(photo) {
        var url = 'https://farm' + photo.farm + '.staticflickr.com/' + photo.server + '/' + photo.id + '_' + photo.secret + '_q.jpg';
        return getTemplate(url, photo.title, 'star');
    }

    function doSearch(term) {
        $('#result-container').html(loader);
        $.get('https://api.flickr.com/services/rest/?method=flickr.photos.search&per_page=20&api_key=f3d09cc2dac27ff1f679df4c6a8eb2d6&text=' + term + '&format=json&nojsoncallback=1').done(function(data) {
            var html = '';
            for(var i = 0; i < data.photos.photo.length; i++) {
                html += parseImage(data.photos.photo[i]);
            }
            $('#result-container').html(html);
        });
    }

    function saveImage(url, title) {
        try {
            var itemsJson = localStorage.getItem('images') || '[]';
            var items = JSON.parse(itemsJson);
            items.push({
                url: url,
                title: title
            });
            localStorage.setItem('images', JSON.stringify(items));
        } catch(e) {

        }
    }

    function removeImage(url) {
        try {
            var itemsJson = localStorage.getItem('images') || '[]';
            var items = JSON.parse(itemsJson);

            items = items.filter(function(item) {
                return url !== item.url;
            });

            localStorage.setItem('images', JSON.stringify(items));
        } catch(e) {

        }
    }

    function loadSavedImages() {
        try {
            var itemsJson = localStorage.getItem('images') || '[]';
            var items = JSON.parse(itemsJson);
            var html = '';
            for(var i = 0; i < items.length; i++) {
                html += getTemplate(items[i].url, items[i].title, 'delete');
            }
            $('#saved-images').html(html);
        } catch(e) {

        }
    }

    $( document ).ready(function() {

        $(".button-collapse").sideNav();


        $('.search-btn').on('click', function() {
            var val = $('#search-input').val();
            doSearch(val);
        });

        $('.reset-btn').on('click', function() {
            $('#result-container').html('');
        });

        $('#result-container').on('click', '.save-image', function() {
            saveImage($(this).data('url'), $(this).data('title'));
        });

        $('#test2').on('click', '.save-image', function() {
            removeImage($(this).data('url'));
            $(this).parents('.image-x').remove();
        });

        doSearch('random');

        $('.tabs').tabs({
            onShow: function(tab) {
                if(tab.attr('id') === 'test2') {
                    loadSavedImages();
                }
            }
        });
    });

</script>
</body>
</html>
